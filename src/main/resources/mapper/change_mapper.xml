<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
   <mapper namespace="kr.co.book.transaction.dao.ChangeDAO">
   	   		
    	<!-- 교환신청 -->
    	<insert id="changeapply">
			INSERT INTO `CHANGE`(MEMBER_IDX,LIBRARY_BOOK,LIBRARY_BOOK2,CHANGE_APPLYDATE,CHANGE_DATE,CHANGE_STATE) 
			VALUES(#{param1},#{param2},#{param3},now(),#{param4},0)
		</insert>
		
		<!-- 교환신청 idx 찾기 -->
		<select id="findchange_idx" resultType="String">		
			SELECT CHANGE_IDX  FROM `CHANGE`
			WHERE MEMBER_IDX = #{param1} AND LIBRARY_BOOK = #{param2} AND LIBRARY_BOOK2 = #{param3}			
		</select>
		
		<!-- 채팅방(신청자) 만들기 -->
		<insert id="createchatroom">
			INSERT INTO CHAT_ROOM(CODE_IDX,MEMBER_IDX,IDX,CHAT_ROOM_STATE) 
			VALUES(#{param1},#{param2},#{param3},0)
		</insert>
		
		<!-- 책에 대한 정보(회원 idx, 책이름) 들고오기 -->
		<select id="findchbmidx" parameterType="hashmap" resultType="change">		
			SELECT * FROM LIBRARY WHERE LIBRARY_IDX = #{LIBRARY_IDX} 
		</select>			
		
		<!-- 신청내역 대화방에 뿌려주기-->
		<insert id="applychatcontent">
			INSERT INTO CHAT(CODE_IDX,IDX,CHAT_SENDER,CHAT_RECIEVER,CHAT_CHAT,CHAT_CHECK,CHAT_DATE)
			VALUES(#{param1},#{param2},#{param3},#{param4},'안녕하세요',0,now())
		</insert>
		
		<!-- 대여신청 -->
		<insert id="rentapply" parameterType="hashmap">
			INSERT INTO RENT(LIBRARY_IDX, MEMBER_IDX, RENT_DEPOSIT, RENT_STARTDATE, RENT_ENDDATE, RENT_STATE)
			VALUES(#{LIBRARY_IDX},#{MEMBER_IDX},#{RENT_DEPOSIT},#{RENT_STARTDATE},#{RENT_ENDDATE},0)
		</insert>
		
		<!-- 대여신청 idx 찾기 -->
		<select id="findrent_idx" parameterType="hashmap" resultType="String">		
			SELECT RENT_IDX  FROM RENT
			WHERE LIBRARY_IDX = #{LIBRARY_IDX} AND MEMBER_IDX = #{MEMBER_IDX}			
		</select>
		
		<!-- 메세지에서 사진전송 -->
		<insert id="fileWrite">
			INSERT INTO PHOTO(CODE_IDX, IDX, MEMBER_IDX, PHOTO_ORINAME, PHOTO_NEWNAME, PHOTO_BLIND)
			VALUES(#{param1},#{param2},#{param3},#{param4},#{param5},0);
		</insert>
		 

    
   
   </mapper>